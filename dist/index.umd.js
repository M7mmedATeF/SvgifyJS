(function(c,a){typeof exports=="object"&&typeof module<"u"?module.exports=a():typeof define=="function"&&define.amd?define(a):(c=typeof globalThis<"u"?globalThis:c||self,c.Svgify=a())})(this,function(){"use strict";class c{constructor(e){this.path="assets/icons",this.version=1,this.loadingMSG="",this.errorMSG="",this.FetchIcon=t=>fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}),this.requestIDX={},this.FetchingList={},this.FetchIconData=async(t,r=!1)=>{let i;try{if(Object.keys(this.FetchingList).includes(t))i=this.FetchingList[t];else if(r){const o=`${this.path}/${t}.svg`,h=this.FetchIcon(o);this.FetchingList[t]=h,i=h}else{const o=this.requestIDX[t]+1||0;o===0&&(this.requestIDX[t]=o),i=new Promise(h=>{setTimeout(async()=>{const s=await this.FetchIconData(t,!0);h(s)},o===0?0:5)})}}catch(o){throw console.error(`Error fetching icon ${t}`),o}return i},e!=null&&e.path&&(this.path=e.path),e!=null&&e.version&&(this.version=e.version),e!=null&&e.FetchIcon&&(this.FetchIcon=e.FetchIcon),e!=null&&e.loadingMSG&&(this.loadingMSG=e.loadingMSG),e!=null&&e.errorMSG&&(this.errorMSG=e.errorMSG),this.currentVersion=Number(localStorage.getItem("svgify_cached_version"))||-1,this.currentVersion===-1?(localStorage.setItem("svgify_cached_version",this.version.toString()),this.currentVersion=this.version):this.currentVersion!==this.version&&(localStorage.clear(),localStorage.setItem("svgify_cached_version",this.version.toString()),this.currentVersion=this.version),this.init()}init(){const e=document.querySelectorAll("i.svgify");(e==null?void 0:e.length)>0&&e.forEach(t=>{const r=t.getAttribute("data-font-weight")||"fill",i=r==="fill"?"svg_modifier_style_fill":r==="stroke"?"svg_modifier_style_stroke":"svg_modifier_style_both";t.classList.add("svg_modifier_style",i),t.innerHTML=""+this.loadingMSG,this.InitSvgIcon(t)})}async InitSvgIcon(e){let t=e.getAttribute("data-icon");if(!t){console.error("Invalid Icon Name"),e.innerHTML=""+this.errorMSG;return}t=""+t;const r=e.getAttribute("data-scale")||1;let i=localStorage.getItem(`svgify_${this.version}_${t}`);if(!i){const h=await(await this.FetchIconData(t)).text();if(h.match(/<html/g))throw e.innerHTML=""+this.errorMSG,new Error("Invalid SVG format");i=this.modifyNewSvgProps(""+h,t),localStorage.setItem(`svgify_${this.version}_${t}`,i)}i=this.calculateSizeRatios(i,Number(r)),e.innerHTML=i}modifyNewSvgProps(e,t){if(e.match(/<html/g))throw new Error("Invalid SVG format");e=e.replace(/fill="[^"]*"/g,"").replace(/stroke="[^"]*"/g,"");try{localStorage.setItem(`svgify_${this.version}_${t}`,JSON.stringify(e))}catch(r){if(r instanceof DOMException&&r.code===22)console.warn("Storage quota exceeded, clearing storage..."),localStorage.clear();else throw r}return e}calculateSizeRatios(e,t){const r=e.match(/width="(\d+(\.\d+)?(px|em|rem|%)?)"/),i=e.match(/height="(\d+(\.\d+)?(px|em|rem|%)?)"/);let o=1;if(r&&i){const h=parseFloat(r[1]);o=parseFloat(i[1])/h}else r||(e=e.replace("<svg",'<svg width="1em"')),i||(e=e.replace("<svg",'<svg height="1em"'));return e=e.replace(/height="[^"]*"/,`height="${t*1.5*o}em"`),e.replace(/width="[^"]*"/,`width="${t*1.5}em"`)}}return c});
